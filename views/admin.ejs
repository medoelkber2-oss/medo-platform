<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø³ØªØ± Ù…ÙŠØ¯Ùˆ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
    * { font-family: 'Cairo', sans-serif; }
    body { background: #0f172a; color: white; padding: 20px; }
    
    @media (max-width: 768px) {
      body { padding: 10px; }
      .container { padding: 0; }
      h2 { font-size: 1.2rem; }
      .btn { padding: 8px 12px; font-size: 0.9rem; }
    }
    
    .mobile-sidebar {
      position: fixed;
      top: 0;
      right: -280px;
      width: 280px;
      height: 100vh;
      background: #1e293b;
      z-index: 9999;
      padding: 20px;
      transition: 0.3s;
    }
    .mobile-sidebar.active { right: 0; }
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 9998;
    }
    .overlay.active { display: block; }
    
    .card-custom { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
    .table { color: white; vertical-align: middle; }
    .code-box { background: rgba(0,0,0,0.3); border-radius: 8px; padding: 8px 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .code-text { font-family: monospace; font-weight: bold; }
    .stat-card { background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 15px; }
    .stat-card h3 { font-size: 2rem; margin: 0; }
    .stat-card.green { background: linear-gradient(135deg, #10b981, #059669); }
    .stat-card.orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .stat-card.red { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .lecture-item { background: rgba(0,0,0,0.2); padding: 8px; margin-bottom: 5px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
    .password-text { font-family: monospace; background: rgba(0,0,0,0.3); padding: 2px 8px; border-radius: 4px; }
  </style>
</head>
<body>

<div class="overlay" onclick="toggleSidebar()"></div>
<div class="mobile-sidebar" id="mobileSidebar">
  <h4 class="text-white mb-4">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h4>
  <a href="#stats" class="btn btn-outline-light w-100 mb-2" onclick="toggleSidebar()">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</a>
  <a href="#courses" class="btn btn-outline-light w-100 mb-2" onclick="toggleSidebar()">ğŸ“š Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</a>
  <a href="#students" class="btn btn-outline-light w-100 mb-2" onclick="toggleSidebar()">ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨</a>
  <a href="#codes" class="btn btn-outline-light w-100 mb-2" onclick="toggleSidebar()">ğŸ”‘ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</a>
  <hr>
  <a href="/logout" class="btn btn-danger w-100">ğŸšª Ø®Ø±ÙˆØ¬</a>
</div>

<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
    <div class="d-flex align-items-center gap-3">
      <button class="btn btn-outline-light d-md-none" onclick="toggleSidebar()">â˜°</button>
      <h2 class="text-primary mb-0">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø³ØªØ± Ù…ÙŠØ¯Ùˆ</h2>
    </div>
    <div>
      <span class="badge bg-danger"><%= (typeof notifications !== 'undefined' && notifications) ? notifications.length : 0 %> Ø¥Ø´Ø¹Ø§Ø±</span>
      <a href="/logout" class="btn btn-danger btn-sm">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
    </div>
  </div>

  <div class="card-custom" id="stats">
    <h4>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h4>
    <div class="row">
      <div class="col-6 col-md-3"><div class="stat-card"><h3><%= stats.totalStudents %></h3><p>ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨</p></div></div>
      <div class="col-6 col-md-3"><div class="stat-card green"><h3><%= stats.activeStudents %></h3><p>âœ… Ù†Ø´Ø·ÙˆÙ†</p></div></div>
      <div class="col-6 col-md-3"><div class="stat-card orange"><h3><%= stats.totalCourses %></h3><p>ğŸ“š ÙƒÙˆØ±Ø³Ø§Øª</p></div></div>
      <div class="col-6 col-md-3"><div class="stat-card red"><h3><%= stats.unusedCodes %></h3><p>ğŸ”‘ Ø£ÙƒÙˆØ§Ø¯ Ù…ØªØ§Ø­Ø©</p></div></div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-5">
      <div class="card-custom">
        <h5>Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯</h5>
        <form action="/admin/add-course" method="POST">
          <input type="text" name="title" class="form-control mb-2 bg-dark text-white" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆØ±Ø³" required>
          <input type="text" name="thumb" class="form-control mb-2 bg-dark text-white" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù">
          <button class="btn btn-primary w-100">Ø¥Ù†Ø´Ø§Ø¡</button>
        </form>
      </div>
    </div>
    <div class="col-md-7">
      <div class="card-custom">
        <h5>Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø©</h5>
        <form action="/admin/add-lecture" method="POST" class="row g-2">
          <div class="col-12">
            <select name="courseId" class="form-select bg-dark text-white" required>
              <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³...</option>
              <% if (typeof courses !== 'undefined' && courses) { %>
                <% courses.forEach(function(c) { %>
                  <option value="<%= c._id %>"><%= c.title %></option>
                <% }); %>
              <% } %>
            </select>
          </div>
          <div class="col-md-6"><input type="text" name="title" class="form-control bg-dark text-white" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required></div>
          <div class="col-md-6"><input type="text" name="vid" class="form-control bg-dark text-white" placeholder="YouTube ID" required></div>
          <div class="col-12"><button class="btn btn-success w-100">Ø¥Ø¶Ø§ÙØ©</button></div>
        </form>
      </div>
    </div>
  </div>

  <div class="card-custom" id="courses">
    <h5>ğŸ“š Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h5>
    <div class="row">
      <% if (typeof courses !== 'undefined' && courses.length > 0) { %>
        <% courses.forEach(function(c) { %>
          <div class="col-md-6 mb-3">
            <div class="code-box d-block">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="fw-bold"><%= c.title %></span>
                <a href="/admin/delete-course/<%= c._id %>" class="btn btn-sm btn-outline-danger" onclick="return confirm('Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³ØŸ')">ğŸ—‘ï¸</a>
              </div>
              <% if (c.lectures && c.lectures.length > 0) { %>
                <% c.lectures.forEach(function(lec, index) { %>
                  <div class="lecture-item">
                    <span class="small"><%= index + 1 %>. <%= lec.title %></span>
                    <a href="/admin/delete-lecture/<%= c._id %>/<%= index %>" class="btn btn-sm text-danger"><i class="fa fa-times"></i></a>
                  </div>
                <% }); %>
              <% } %>
            </div>
          </div>
        <% }); %>
      <% } %>
    </div>
  </div>

  <div class="card-custom" id="students">
    <h5>ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ†</h5>
    <div class="table-responsive">
      <table class="table table-dark table-hover text-center">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th>
            <th>Ø§Ù„ØªØ­ÙƒÙ…</th>
          </tr>
        </thead>
        <tbody>
          <% if (typeof students !== 'undefined' && students.length > 0) { %>
            <% students.forEach(function(s) { %>
              <tr>
                <td><%= s.username %></td>
                <td><code class="text-info"><%= s.password %></code></td>
                <td>
                  <a href="/admin/delete-student/<%= s._id %>" class="btn btn-sm btn-danger" onclick="return confirm('Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')">Ø­Ø°Ù</a>
                </td>
              </tr>
            <% }); %>
          <% } else { %>
            <tr><td colspan="3">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card-custom" id="codes">
    <h5>ğŸ”‘ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„</h5>
    <div class="mb-3">
      <a href="/admin/generate-keys" class="btn btn-sm btn-warning">ØªÙˆÙ„ÙŠØ¯ 20 ÙƒÙˆØ¯</a>
      <a href="/admin/delete-all-codes" class="btn btn-sm btn-danger" onclick="return confirm('Ø­Ø°Ù Ø§Ù„ÙƒÙ„ØŸ')">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</a>
    </div>
    <div class="row g-2" style="max-height: 250px; overflow-y: auto;">
      <% if (typeof codes !== 'undefined' && codes.length > 0) { %>
        <% codes.forEach(function(code) { %>
          <div class="col-md-3 col-6">
            <div class="code-box">
              <span class="code-text <%= code.used ? 'text-danger text-decoration-line-through' : 'text-success' %>">
                <%= code.code %>
              </span>
              <button class="btn btn-sm text-light" onclick="copyCode('<%= code.code %>')"><i class="fa fa-copy"></i></button>
            </div>
          </div>
        <% }); %>
      <% } %>
    </div>
  </div>
</div>

<script>
  function toggleSidebar() {
    document.getElementById('mobileSidebar').classList.toggle('active');
    document.querySelector('.overlay').classList.toggle('active');
  }

  function copyCode(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯: ' + text);
    }).catch(err => {
      console.error('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®: ', err);
    });
  }
</script>

</body>
</html>
