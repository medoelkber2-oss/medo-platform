<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø³ØªØ± Ù…ÙŠØ¯Ùˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #0f172a; color: white; padding: 20px; }
        .card-custom { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .table { color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-primary fw-bold">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø³ØªØ± Ù…ÙŠØ¯Ùˆ ğŸ› ï¸</h2>
            <a href="/logout" class="btn btn-danger">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
        </div>

        <div class="row">
            <div class="col-md-5">
                <div class="card-custom">
                    <h5>Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯ (ØºÙ„Ø§Ù ÙˆØ¹Ù†ÙˆØ§Ù†)</h5>
                    <form action="/admin/add-course" method="POST">
                        <input type="text" name="title" class="form-control mb-2" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆØ±Ø³" required>
                        <input type="text" name="thumb" class="form-control mb-2" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù">
                        <button class="btn btn-primary w-100">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ±Ø³</button>
                    </form>
                </div>
            </div>
            <div class="col-md-7">
                <div class="card-custom">
                    <h5>Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ù„ÙƒÙˆØ±Ø³ Ù…ÙˆØ¬ÙˆØ¯</h5>
                    <form action="/admin/add-lecture" method="POST" class="row g-2">
                        <div class="col-12">
                            <select name="courseId" class="form-select" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù...</option>
                                <% courses.forEach(c => { %> <option value="<%= c._id %>"><%= c.title %></option> <% }) %>
                            </select>
                        </div>
                        <div class="col-md-6"><input type="text" name="title" class="form-control" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" required></div>
                        <div class="col-md-6"><input type="text" name="vid" class="form-control" placeholder="YouTube Video ID" required></div>
                        <div class="col-12"><button class="btn btn-success w-100">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</button></div>
                    </form>
                </div>
            </div>
        </div>

        <div class="card-custom">
            <h5>Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h5>
            <table class="table table-dark table-hover">
                <thead><tr><th>Ø§Ù„ØºÙ„Ø§Ù</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</th><th>Ø§Ù„ØªØ­ÙƒÙ…</th></tr></thead>
                <tbody>
                    <% courses.forEach(c => { %>
                    <tr>
                        <td><img src="<%= c.thumb %>" width="50" class="rounded"></td>
                        <td><%= c.title %></td>
                        <td><%= c.lectures ? c.lectures.length : 0 %></td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="openEditModal('<%= c._id %>')"><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„</button>
                            <a href="/admin/delete-course/<%= c._id %>" class="btn btn-sm btn-danger" onclick="return confirm('Ø­Ø°ÙØŸ')"><i class="fas fa-trash"></i></a>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>

        <div class="card-custom">
            <div class="d-flex justify-content-between mb-3">
                <h5>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</h5>
                <a href="/admin/generate-keys" class="btn btn-sm btn-success">ØªÙˆÙ„ÙŠØ¯ 20 ÙƒÙˆØ¯</a>
            </div>
            <div class="row" style="max-height: 200px; overflow-y: auto;">
                <% codes.forEach(code => { %>
                    <div class="col-md-3 mb-2 small"><span class="<%= code.used ? 'text-danger' : 'text-success' %>"><%= code.code %></span></div>
                <% }) %>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-white border-secondary">
                <form id="editForm" method="POST">
                    <div class="modal-header border-secondary"><h5>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙˆØ±Ø³</h5></div>
                    <div class="modal-body">
                        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆØ±Ø³</label>
                        <input type="text" name="title" id="editTitle" class="form-control mb-2 bg-dark text-white border-secondary" required>
                        <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØºÙ„Ø§Ù</label>
                        <input type="text" name="thumb" id="editThumb" class="form-control bg-dark text-white border-secondary">
                    </div>
                    <div class="modal-footer border-secondary">
                        <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function openEditModal(id) {
            const res = await fetch('/admin/course-data/' + id);
            const course = await res.json();
            document.getElementById('editTitle').value = course.title;
            document.getElementById('editThumb').value = course.thumb;
            document.getElementById('editForm').action = '/admin/edit-course/' + id;
            new bootstrap.Modal(document.getElementById('editModal')).show();
        }
    </script>
</body>
</html>
